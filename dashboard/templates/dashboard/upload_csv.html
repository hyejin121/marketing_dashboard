{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CSV 업로드</title>
    <!-- Bootstrap (CDN) 추가 : 테이블을 좀 더 예쁘게 보이게 하기-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- chart.js추가 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="p-4">
<h1> CSV 업로드 </h1>
<!-- # method="POST" : 서버에 데이터 전송 / enctype="multipart/form-data : 파일 전송 시 필요-->
    <form method="POST" enctype="multipart/form-data" class="mb-4">
    {% csrf_token %}     <!-- django 보안 토큰(필수)-->
        <!--CSV 파일 업로드-->
        <div class="mb-3">
            <input type="file" name="csv_file" accept=".csv" required>
        </div>

        <!-- 컬럼 선택 드롭다운 -->
        {% if numeric_cols|length > 0 %}
            <div class="mb-3">
                <label for="selected_column" class="form-label"> 차트로 보고 싶은 컬럼 선택:</label>
                <select name="selected_column" id="selected_column" class="form-select" required>
                    {% for col in numeric_cols %}
                        <option value="{{ col }}" {% if selected_column == col %}selected{% endif %}>{{ col }}</option>
                    {% endfor %}
                </select>
            </div>
        {% endif %}

        <!--업로드 버튼-->
        <button type="submit" class="btn btn-primary">업로드 및 분석 </button>
    </form>

    {% if table_html %}
        <h2>업로드한 csv 데이터 미리보기</h2>
        <div>
            {{ table_html|safe }}
            <!-- HTML 태그를 그대로 렌더링 (안그러면 HTML 문자열로 출력 됨)-->
        </div>
    {% endif %}

    {% if stats_html %}
        <h2>기본 통계 정보</h2>
        <div>
            {{ stats_html|safe }}
        </div>
    {% endif %}

    <!-- chart_data -->
    {% if chart_data %}
    <h2 class="mt-5">기본 차트 시각화 (예시)</h2>
    <!-- chart-data div: 데이터를 data-* 속성으로 전달 -->
    <div id="chart-data"
         data-labels='{{ chart_labels|safe }}'
         data-data='{{ chart_data|safe }}'>
    </div>
    <canvas id="myChart" width="400" height="200"></canvas>
    {% endif %}

    <!--line-chart-->
    {% if line_chart_data %}
        <h2 class="mt-5">Line Chart (선 그래프) 예시</h2>

        <!-- data-* 속성으로 데이터 전달-->
        <div id="line-chart-data"
             data-labels='{{ line_chart_labels|safe }}'
             data-data='{{ line_chart_data|safe }}'>
        </div>

        <canvas id="lineChart" width="400" height="200"></canvas>
    {% endif %}

    <!-- Pie Chart -->
    {% if pie_chart_data %}
        <h2 class="mt-5">Pie Chart (원형 차트) 예시</h2>

        <!-- data-* 속성으로 데이터 전달 -->
        <div id="pie-chart-data"
            data-labels='{{ pie_chart_labels|safe }}'
            data-data='{{ pie_chart_data|safe }}'>
        </div>

        <canvas id="pieChart" width="400" height="200"></canvas>
    {% endif %}

<!-- js 파일 연결 -->
<script src="{% static 'dashboard/js/my_Chart.js' %}"></script>
<script src="{% static 'dashboard/js/line_Chart.js' %}"></script>
<script src="{% static 'dashboard/js/pie_Chart.js' %}"></script>


    <p class="mt-3"><a href="{% url 'home' %}">홈으로 돌아가기</a></p>
</body>
</html>